<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1.0" name="viewport">
<meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
<meta content="A Cylon.JS code example" name="description">
<meta content="The Hybrid Group" name="author">
<title>Cylon.JS Example - Sphero Collisions</title>
<link href="/stylesheets/style.css" rel="stylesheet">
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script><script src="/javascript/script.js"></script><script src="/hybridpages/assets/javascript/subnav.js"></script><link href="//fonts.googleapis.com/css?family=Inconsolata:400,700%7CMontserrat:700" rel="stylesheet">
<link href="/favicon.ico" rel="shortcut icon" type="image/gif">
<script type="text/javascript">


  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-46433484-2', {"cookieDomain":"cylonjs.com"});











   ga('send', 'pageview');


</script></head>
<body>
    
    <div class="app">
      <div class="w">
        <header class="app-header" role="banner"><div class="display">
            <h1 class="app-logo">
              <a href="/">Cylon</a>
            </h1>
            <span class="subtitle">
              <div class="main"></div>
            </span>
          </div>
          <span class="menu">
            <a class="active" href="/documentation">Docs</a>
            <a href="/documentation/platforms" class="item">Platforms</a>
            
            <a href="/blog" class="item">Blog</a>
            <a class="item" target="_blank" href="https://github.com/hybridgroup/cylon/">Github</a>
          </span>
        </header>
</div>
      <div class="page-title">
        <div class="w">
          <h1 class="title">Example: Sphero Collisions</h1>
          <h2 class="subtitle"><a href="https://github.com/hybridgroup/cylon-sphero/tree/master/examples/collision" target="_blank">View In Repo</a></h2>
        </div>
      </div>
      <div class="container">
        <div class="main" role="main">
          <section class="content full"><div class="documentation">
              <h1 id="sphero-collisions">Sphero Collisions</h1>
              
              <p>For this Cylon example, we're going to set up a Sphero such that it will change
              it's color and roll in a random direction when it has a collision.</p>
              
              <p>Before we get started, make sure you have the <code>cylon-sphero</code> module installed.</p>
              
              <p>First, let's load up Cylon:</p>
              
              <pre class="CodeRay"><span class="keyword">var</span> Cylon = require(<span class="string"><span class="delimiter">'</span><span class="content">cylon</span><span class="delimiter">'</span></span>);
</pre>
              
              <p>With that loaded, we can begin defining our robot.</p>
              
              <pre class="CodeRay">Cylon.robot({
</pre>
              
              <p>We're going to have one connection, and one device for this robot, both the same
              Sphero.</p>
              
              <pre class="CodeRay">  connection: { <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">sphero</span><span class="delimiter">'</span></span>, <span class="key">adaptor</span>: <span class="string"><span class="delimiter">'</span><span class="content">sphero</span><span class="delimiter">'</span></span>, <span class="key">port</span>: <span class="string"><span class="delimiter">'</span><span class="content">/dev/rfcomm0</span><span class="delimiter">'</span></span> },
  <span class="key">device</span>: { <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">sphero</span><span class="delimiter">'</span></span>, <span class="key">driver</span>: <span class="string"><span class="delimiter">'</span><span class="content">sphero</span><span class="delimiter">'</span></span> },
</pre>
              
              <p>With the necessary hardware defined, we can now start telling Cylon about the
              work our robot will be performing.</p>
              
              <pre class="CodeRay">  <span class="function">work</span>: <span class="keyword">function</span>(me) {
</pre>
              
              <p>We'll assign some variables here for later, a basic color for our sphero and
              a variable we'll use for a bitwise math operation later.</p>
              
              <pre class="CodeRay">    <span class="keyword">var</span> color = <span class="hex">0x00FF00</span>,
        bitFilter = <span class="hex">0xFFFF00</span>;
</pre>
              
              <p>When our Sphero emits the 'connect' event, we're going to hook up collision
              detection, make sure it's not moving, and set a color.</p>
              
              <pre class="CodeRay">    me.sphero.on(<span class="string"><span class="delimiter">'</span><span class="content">connect</span><span class="delimiter">'</span></span>, <span class="keyword">function</span>() {
      console.log(<span class="string"><span class="delimiter">"</span><span class="content">Setting up Collision Detection...</span><span class="delimiter">"</span></span>);
      me.sphero.detectCollisions();
      me.sphero.setRGB(color);
      me.sphero.stop();
    });
</pre>
              
              <p>And when our Sphero detects a collision, we want to notify the user of this via
              the console.</p>
              
              <pre class="CodeRay">    me.sphero.on(<span class="string"><span class="delimiter">'</span><span class="content">collision</span><span class="delimiter">'</span></span>, <span class="keyword">function</span>(data) {
      console.log(<span class="string"><span class="delimiter">"</span><span class="content">Collision:</span><span class="delimiter">"</span></span>);
</pre>
              
              <p>We get the new color for a Sphero by doing a bitwise XOR operation on it, using
              the bitfilter above.</p>
              
              <pre class="CodeRay">      color = color ^ bitFilter;
</pre>
              
              <p>With our new color in hand, we can let the user know what color we're using now,
              and change the Sphero to that color. We'll also tell the Sphero to roll in
              a random direction, at speed 90.</p>
              
              <pre class="CodeRay">      console.log(<span class="string"><span class="delimiter">"</span><span class="content">Color: </span><span class="delimiter">"</span></span> + (color.toString(<span class="integer">16</span>)) + <span class="string"><span class="delimiter">"</span><span class="content"> </span><span class="delimiter">"</span></span>);
      me.sphero.setRGB(color);
      me.sphero.roll(<span class="integer">90</span>, Math.floor(Math.random() * <span class="integer">360</span>));
    });
  }
</pre>
              
              <p>And with all that said and done, we can now start the robot.</p>
              
              <pre class="CodeRay">}).start();
</pre>
            </div>
          </section>
</div>
      </div>
    </div>
    <footer class="app-footer"><div class="w">
        <div class="copyright">
          <div class="left-side">
            Â© Copyright 2012-2014
            <a href="http://hybridgroup.com" id="THG-logo" target="_blank">
              <img alt="The Hybrid Group" src="/images/elements/THG_logo.png"></a>
          </div>
          <div class="right-side">
            <a href="#top">Top</a>
          </div>
          <div class="clear"></div>
        </div>
      </div>
    </footer>
</body>
</html>
