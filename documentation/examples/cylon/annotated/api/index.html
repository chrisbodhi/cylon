<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1.0" name="viewport">
<meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
<meta content="A Cylon.JS code example" name="description">
<meta content="The Hybrid Group" name="author">
<title>Cylon.JS Example - API</title>
<link href="/stylesheets/style.css" rel="stylesheet">
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script><script src="/javascript/script.js"></script><script src="/hybridpages/assets/javascript/subnav.js"></script><link href="//fonts.googleapis.com/css?family=Inconsolata:400,700%7CMontserrat:700" rel="stylesheet">
<link href="/favicon.ico" rel="shortcut icon" type="image/gif">
<script type="text/javascript">


  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-46433484-2', {"cookieDomain":"cylonjs.com"});











   ga('send', 'pageview');


</script></head>
<body>
    
    <div class="app">
      <div class="w">
        <header class="app-header" role="banner"><div class="display">
            <h1 class="app-logo">
              <a href="/">Cylon</a>
            </h1>
            <span class="subtitle">
              <div class="main"></div>
            </span>
          </div>
          <span class="menu">
            <a class="active" href="/documentation">Docs</a>
            <a href="/documentation/platforms" class="item">Platforms</a>
            
            <a href="/blog" class="item">Blog</a>
            <a class="item" target="_blank" href="https://github.com/hybridgroup/cylon/">Github</a>
          </span>
        </header>
</div>
      <div class="page-title">
        <div class="w">
          <h1 class="title">Example: API</h1>
          <h2 class="subtitle"><a href="https://github.com/hybridgroup/cylon/tree/master/examples/api" target="_blank">View In Repo</a></h2>
        </div>
      </div>
      <div class="container">
        <div class="main" role="main">
          <section class="content full"><div class="documentation">
              <h1 id="api">API</h1>
              
              <p>In this Cylon example, we'll be demonstrating the HTTP API that Cylon spins up
              when it starts.</p>
              
              <p>This example involves two Spheros, so before you start make sure you have the
              <code>cylon-sphero</code> module installed.</p>
              
              <p>First, let's import Cylon:</p>
              
              <pre class="CodeRay"><span class="keyword">var</span> Cylon = require(<span class="string"><span class="delimiter">'</span><span class="content">cylon</span><span class="delimiter">'</span></span>);
</pre>
              
              <p>Next up, we'll configure the API Cylon will serve, telling it to serve on port
              <code>8080</code>.</p>
              
              <pre class="CodeRay">Cylon.api({<span class="key">host</span>: <span class="string"><span class="delimiter">'</span><span class="content">0.0.0.0</span><span class="delimiter">'</span></span>, <span class="key">port</span>: <span class="string"><span class="delimiter">'</span><span class="content">8080</span><span class="delimiter">'</span></span>});
</pre>
              
              <p>Since we're making two very similar robots (Spheros, in this case), let's put
              the different parts of each robot in objects so we can initialize them later.
              The only differences between the bots are their names and the port they'll be
              using.</p>
              
              <pre class="CodeRay"><span class="keyword">var</span> bots = [
  { <span class="key">port</span>: <span class="string"><span class="delimiter">'</span><span class="content">/dev/rfcomm0</span><span class="delimiter">'</span></span>, <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Thelma</span><span class="delimiter">'</span></span> },
  { <span class="key">port</span>: <span class="string"><span class="delimiter">'</span><span class="content">/dev/rfcomm1</span><span class="delimiter">'</span></span>, <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Louise</span><span class="delimiter">'</span></span> }
];
</pre>
              
              <p>Now we can define the basic robot both of our Sphero robots will be based on.</p>
              
              <pre class="CodeRay"><span class="keyword">var</span> SpheroRobot = {
</pre>
              
              <p>Both robots will be connecting to Spheros, and so using the cylon-sphero
              adaptor:</p>
              
              <pre class="CodeRay">  connection: { <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Sphero</span><span class="delimiter">'</span></span>, <span class="key">adaptor</span>: <span class="string"><span class="delimiter">'</span><span class="content">sphero</span><span class="delimiter">'</span></span> },
</pre>
              
              <p>And both will be connecting to the same kind of device (you guessed it,
              a Sphero).</p>
              
              <pre class="CodeRay">  device: { <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">sphero</span><span class="delimiter">'</span></span>, <span class="key">driver</span>: <span class="string"><span class="delimiter">'</span><span class="content">sphero</span><span class="delimiter">'</span></span> },
</pre>
              
              <p>Both robots will be performing the same kind of work as well.  Every second,
              they'll print their name to the console, set themselves to a random color, and
              roll in a random direction.</p>
              
              <pre class="CodeRay">  <span class="function">work</span>: <span class="keyword">function</span>(my) {
    every((<span class="integer">1</span>).seconds(), <span class="keyword">function</span>() {
      console.log(my.name);
      my.sphero.setRandomColor();
      my.sphero.roll(<span class="integer">60</span>, Math.floor(Math.random() * <span class="integer">360</span>));
    });
  }
};
</pre>
              
              <p>Now that we know what hardware the robots have and what work they'll be doing,
              let's create them! We'll iterate through our earlier <code>bots</code> array, creating
              a new Robot, assigning it it's unique characteristics, then passing it off to
              Cylon so it can keep track of it.</p>
              
              <pre class="CodeRay"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="integer">0</span>; i &lt; bots.length; i++) {
  <span class="keyword">var</span> bot = bots[i];
  <span class="keyword">var</span> robot = Object.create(SpheroRobot);

  robot.connection.port = bot.port;
  robot.name = bot.name;

  Cylon.robot(robot);
}
</pre>
              
              <p>And now that Cylon has all the robots we're intending to give it, let's get
              started!</p>
              
              <pre class="CodeRay">Cylon.start();
</pre>
              
              <p>Now Cylon will start up the robots and their devices, as well as an API server
              listening on <code>0.0.0.0:8080</code>.</p>
            </div>
          </section>
</div>
      </div>
    </div>
    <footer class="app-footer"><div class="w">
        <div class="copyright">
          <div class="left-side">
            Â© Copyright 2012-2014
            <a href="http://hybridgroup.com" id="THG-logo" target="_blank">
              <img alt="The Hybrid Group" src="/images/elements/THG_logo.png"></a>
          </div>
          <div class="right-side">
            <a href="#top">Top</a>
          </div>
          <div class="clear"></div>
        </div>
      </div>
    </footer>
</body>
</html>
