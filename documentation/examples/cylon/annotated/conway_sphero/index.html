<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1.0" name="viewport">
<meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
<meta content="A Cylon.JS code example" name="description">
<meta content="The Hybrid Group" name="author">
<title>Cylon.JS Example - Conway's Game Of Life - With Spheros</title>
<link href="/stylesheets/style.css" rel="stylesheet">
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script><script src="/javascript/script.js"></script><script src="/hybridpages/assets/javascript/subnav.js"></script><link href="//fonts.googleapis.com/css?family=Inconsolata:400,700%7CMontserrat:700" rel="stylesheet">
<link href="/favicon.ico" rel="shortcut icon" type="image/gif">
<script type="text/javascript">


  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-46433484-2', {"cookieDomain":"cylonjs.com"});











   ga('send', 'pageview');


</script></head>
<body>
    
    <div class="app">
      <div class="w">
        <header class="app-header" role="banner"><div class="display">
            <h1 class="app-logo">
              <a href="/">Cylon</a>
            </h1>
            <span class="subtitle">
              <div class="main"></div>
            </span>
          </div>
          <span class="menu">
            <a href="/documentation" class="item">Docs</a>
            <a href="/documentation/platforms" class="item">Platforms</a>
            
            <a href="/blog" class="item">Blog</a>
            <a class="item" target="_blank" href="https://github.com/hybridgroup/cylon/">Github</a>
          </span>
        </header>
</div>
      <div class="page-title">
        <div class="w">
          <h1 class="title">Example: Conway's Game Of Life - With Spheros</h1>
          <h2 class="subtitle"><a href="https://github.com/hybridgroup/cylon/tree/master/examples/conway_sphero" target="_blank">View In Repo</a></h2>
        </div>
      </div>
      <div class="container">
        <div class="main" role="main">
          <section class="content full"><div class="documentation">
              <h1 id="conways-game-of-life---with-spheros">Conway's Game Of Life - With Spheros</h1>
              
              <p>For this Cylon example, we're going to run a version of <a href="https://en.wikipedia.org/wiki/Conway&amp;#x27;s_Game_of_Life">Conway's Game Of
              Life</a>, using Spheros as cells.</p>
              
              <p>To account for the fact that we're now using Spheros to play the game, we need
              to make some changes to the mechanics. Here's how our version of Conway's Game
              will go:</p>
              
              <ul>
<li>"alive" Spheros glow green, "dead" spheros glow red.</li>
                <li>At the start of the game, all Spheros are "alive".</li>
                <li>On every tick, the "alive" Spheros roll randomly, and count the number of
              collisions they have.</li>
                <li>After the tick, all the Spheros that had between two and six collisions are
              considered "alive", and those with less than two or more than six collisions
              are now "dead"</li>
                <li>If a "dead" Sphero is bumped into by an "alive" one, or has collisions through
              other means, it can become "alive" again.</li>
              </ul>
<p>With those alterations in hand, let's start building it with Cylon! Before you
              start, make sure you have the <code>cylon-sphero</code> module installed.</p>
              
              <p>First off, let's load up Cylon:</p>
              
              <pre class="CodeRay"><span class="keyword">var</span> Cylon = require(<span class="string"><span class="delimiter">'</span><span class="content">cylon</span><span class="delimiter">'</span></span>);
</pre>
              
              <p>We'll be using four robots for this example, but they'll have very similar
              programming so we just need to define what's different between them for now.
              Each of the robots will have a unique name, and will communicate on their own
              port.</p>
              
              <pre class="CodeRay"><span class="keyword">var</span> bots = [
  { <span class="key">port</span>: <span class="string"><span class="delimiter">'</span><span class="content">/dev/rfcomm0</span><span class="delimiter">'</span></span>, <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Thelma</span><span class="delimiter">'</span></span> },
  { <span class="key">port</span>: <span class="string"><span class="delimiter">'</span><span class="content">/dev/rfcomm1</span><span class="delimiter">'</span></span>, <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Louise</span><span class="delimiter">'</span></span> },
  { <span class="key">port</span>: <span class="string"><span class="delimiter">'</span><span class="content">/dev/rfcomm2</span><span class="delimiter">'</span></span>, <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Grace</span><span class="delimiter">'</span></span> },
  { <span class="key">port</span>: <span class="string"><span class="delimiter">'</span><span class="content">/dev/rfcomm3</span><span class="delimiter">'</span></span>, <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Ada</span><span class="delimiter">'</span></span> }
];
</pre>
              
              <p>For easier use later, let's define the colors we'll be using with the Spheros,
              green for alive and red for dead:</p>
              
              <pre class="CodeRay"><span class="keyword">var</span> Green = <span class="hex">0x0000FF</span>;
<span class="keyword">var</span> Red = <span class="hex">0xFF0000</span>;
</pre>
              
              <p>That gets the basics out of the way.</p>
              
              <p>Since, as previously mentioned, our robots all have the same basic
              functionality, we can define that functionality in a CoffeeScript class. Since
              we're feeling particularly creative today, let's call this class <code>ConwayRobot</code>:</p>
              
              <pre class="CodeRay"><span class="keyword">var</span> ConwayRobot = (<span class="keyword">function</span>() {
  <span class="keyword">function</span> <span class="function">ConwayRobot</span>() {}
</pre>
              
              <p>All of our robots will be connecting to a Sphero, and be operating via a single
              device (you guessed it, a Sphero).</p>
              
              <pre class="CodeRay">  ConwayRobot.prototype.connection = { <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Sphero</span><span class="delimiter">'</span></span>, <span class="key">adaptor</span>: <span class="string"><span class="delimiter">'</span><span class="content">sphero</span><span class="delimiter">'</span></span> };
  ConwayRobot.prototype.device = { <span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">sphero</span><span class="delimiter">'</span></span>, <span class="key">driver</span>: <span class="string"><span class="delimiter">'</span><span class="content">sphero</span><span class="delimiter">'</span></span> };
</pre>
              
              <p>When the robots are first started, they are born. This sets their contacts to
              zero, their age to zero, makes them "alive", and starts them moving for the
              first tick.</p>
              
              <pre class="CodeRay">  ConwayRobot.prototype.<span class="function">born</span> = <span class="keyword">function</span>() {
    <span class="local-variable">this</span>.contacts = <span class="integer">0</span>;
    <span class="local-variable">this</span>.age = <span class="integer">0</span>;
    <span class="local-variable">this</span>.life();
    <span class="local-variable">this</span>.move();
  };
</pre>
              
              <p>When a robot is asked to move, it rolls in a random direction at speed 60.</p>
              
              <pre class="CodeRay">  ConwayRobot.prototype.<span class="function">move</span> = <span class="keyword">function</span>() {
    <span class="local-variable">this</span>.sphero.roll(<span class="integer">60</span>, Math.floor(Math.random() * <span class="integer">360</span>));
  };
</pre>
              
              <p>In the case of our robots, "life" just means the robot's internal "alive" state
              is set to <code>true</code>, and the Sphero's LED is set to green.</p>
              
              <pre class="CodeRay">  ConwayRobot.prototype.<span class="function">life</span> = <span class="keyword">function</span>() {
    <span class="local-variable">this</span>.alive = <span class="predefined-constant">true</span>;
    <span class="local-variable">this</span>.sphero.setRGB(Green);
  };
</pre>
              
              <p>Similarly, "death" just sets the "alive" state to false, the Sphero's color to
              red, and stops the Sphero from moving.</p>
              
              <pre class="CodeRay">  ConwayRobot.prototype.<span class="function">death</span> = <span class="keyword">function</span>() {
    <span class="local-variable">this</span>.alive = <span class="predefined-constant">false</span>;
    <span class="local-variable">this</span>.sphero.setRGB(Red);
    <span class="local-variable">this</span>.sphero.stop();
  };
</pre>
              
              <p>A robot is decided to have enough contacts if it has between two and six
              contacts.</p>
              
              <pre class="CodeRay">  ConwayRobot.prototype.<span class="function">enoughContacts</span> = <span class="keyword">function</span>() {
    <span class="keyword">return</span> (<span class="local-variable">this</span>.contacts &gt;= <span class="integer">2</span> &amp;&amp; <span class="local-variable">this</span>.contacts &lt; <span class="integer">7</span>);
  };
</pre>
              
              <p>On a robot's birthday, it increments it's age, prints it's name, age, and
              contacts to the console, and then determines if it's now alive or dead based on
              the number of contacts it had in the last tick.</p>
              
              <pre class="CodeRay">  ConwayRobot.prototype.<span class="function">birthday</span> = <span class="keyword">function</span>() {
    <span class="local-variable">this</span>.age += <span class="integer">1</span>;

    console.log(<span class="string"><span class="delimiter">"</span><span class="content">Happy birthday, </span><span class="delimiter">"</span></span> + <span class="local-variable">this</span>.name + <span class="string"><span class="delimiter">"</span><span class="content">. You are </span><span class="delimiter">"</span></span> + <span class="local-variable">this</span>.age + <span class="string"><span class="delimiter">"</span><span class="content"> and had </span><span class="delimiter">"</span></span> + <span class="local-variable">this</span>.contacts + <span class="string"><span class="delimiter">"</span><span class="content"> contacts.</span><span class="delimiter">"</span></span>);

    <span class="keyword">if</span> (<span class="local-variable">this</span>.enoughContacts()) {
      <span class="keyword">if</span> (<span class="local-variable">this</span>.alive == <span class="predefined-constant">null</span>) { <span class="local-variable">this</span>.rebirth(); }
    } <span class="keyword">else</span> {
      <span class="local-variable">this</span>.death();
    }

    <span class="local-variable">this</span>.contacts = <span class="integer">0</span>;
  };
</pre>
              
              <p>Now that the pieces are there, we can set up our robot's work. It starts by
              being "born", then moves every three seconds if it's alive, celebrates it's
              birthday every ten seconds if it's alive, and increments it's contacts every
              time the Sphero detects a collision.</p>
              
              <pre class="CodeRay">  ConwayRobot.prototype.<span class="function">work</span> = <span class="keyword">function</span>(me) {
    me.born();

    me.sphero.on(<span class="string"><span class="delimiter">'</span><span class="content">collision</span><span class="delimiter">'</span></span>, <span class="keyword">function</span>() {
      <span class="local-variable">this</span>.contacts += <span class="integer">1</span>;
    });

    every((<span class="integer">3</span>).seconds(), <span class="keyword">function</span>() {
      <span class="keyword">if</span> (me.alive != <span class="predefined-constant">null</span>) { me.move(); }
    });

    every((<span class="integer">10</span>).seconds(), <span class="keyword">function</span>() {
      <span class="keyword">if</span> (me.alive != <span class="predefined-constant">null</span>) { me.birthday(); }
    });
  };

  <span class="keyword">return</span> ConwayRobot;
})();
</pre>
              
              <p>Now that we've defined the behaviour of our Conway's Game robots, we can make
              the robots themselves.</p>
              
              <p>For each of the sets of unique characteristics in the earlier <code>bots</code> array,
              we'll create a new <code>ConwayRobot</code>, assign it it's unique characteristics, and
              pass it to Cylon so it will keep track of them.</p>
              
              <pre class="CodeRay"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="integer">0</span>; i &lt; bots.length; i++) {
  <span class="keyword">var</span> bot = bots[i];
  <span class="keyword">var</span> robot = <span class="keyword">new</span> ConwayRobot;

  robot.connection.port = bot.port;
  robot.name = bot.name;

  Cylon.robot(robot);
}
</pre>
              
              <p>Now that Cylon knows about our robots and what they do, we can get started!</p>
              
              <pre class="CodeRay">Cylon.start();
</pre>
            </div>
          </section>
</div>
      </div>
    </div>
    <footer class="app-footer"><div class="w">
        <div class="copyright">
          Â© Copyright 2012-2014
          <a href="http://hybridgroup.com">The Hybrid Group.</a>
        </div>
      </div>
    </footer>
</body>
</html>
